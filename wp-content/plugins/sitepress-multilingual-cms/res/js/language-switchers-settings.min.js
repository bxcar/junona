var WPML_core=WPML_core||{};WPML_core.languageSwitcher=function(a,b){"use strict";var c,d,e,f="wpml-ls-inline-styles-additional-css",g="wpml-ls-inline-styles-dialog",h=function(){c=a("#wpml-ls-settings-form"),d=a("#wpml-ls-dialog"),e=c.add(d),j(),o(),s(),n(),i(),a(document).trigger("wpml_ls_admin_loaded")},i=function(){k(),l(),m(),t(),u(),v(),x(),Q(),R(),P(),T(),y(),z(),A()},j=function(){if(a("#"+f).length<1){var b=a("<style>");b.attr("id",f),b.appendTo(a("head"))}},k=function(){e.on("change",".js-wpml-ls-trigger-save",function(){U(a(this))}),e.on("keyup",".js-wpml-ls-trigger-need-save",function(){var c=a(this),d=c.closest(".js-wpml-ls-option").find(".js-wpml-ls-messages");X(d,b.strings.leave_text_box_to_save,0,"notice")})},l=function(){e.on("click",".js-wpml-ls-toggle-slot",function(){var b=a(this),c=a(b.data("target"));c.slideToggle({complete:function(){c.is(":visible")?(b.addClass("open"),c.find(".js-wpml-ls-row-edit").trigger("click")):b.removeClass("open"),q()}})}).on("click",".js-wpml-ls-toggle-once",function(){var b=a(this).nextAll(".js-wpml-ls-toggle-target");a(this).find("label").unwrap().find(".js-arrow-toggle").remove(),b.slideToggle()})},m=function(){e.on("click.tooltip",".js-wpml-ls-tooltip-open",function(b){b.preventDefault(),B(a(this))})},n=function(){a("#wpml-ls-languages-order").sortable({stop:function(){U(a(this))}})},o=function(){d.dialog({dialogClass:"dialog-fixed otgs-ui-dialog wpml-ls-dialog",width:"90%",modal:!0,autoOpen:!1,draggable:!0,resizable:!1}).on("dialogopen",function(){a("body").css("overflow","hidden"),a(".js-wpml-ls-active-tooltip").pointer("close"),q(),r()}).on("dialogclose",function(){a("body").css("overflow","auto"),a(".js-wpml-ls-active-tooltip").pointer("close"),Y()}),a(window).resize(p)},p=_.debounce(function(){q(),r()},200),q=function(){var b=(a(window).width()-180,a(window).height()-180);d.dialog("option","maxHeight",b),d.dialog("option","position",{my:"center",at:"center",of:window})},r=function(){var a=d.find(".js-wpml-ls-preview-wrapper"),b=d.width()>900,c=a.height()+200<d.height();c=c||b&&a.height()<d.height(),c?d.on("scroll.preview",function(){d.find(".js-wpml-ls-preview-wrapper").css({position:"relative",top:d.scrollTop()})}):d.off("scroll.preview").find(".js-wpml-ls-preview-wrapper").css({position:"relative",top:0})},s=function(b){b=b||c,b.find(".js-wpml-ls-colorpicker").wpColorPicker({change:function(b){var c=a(b.target).parents(".js-wpml-ls-subform");S(c)},clear:function(b){var c=a(b.target).parents(".js-wpml-ls-subform");S(c)}})},t=function(){a(".js-wpml-ls-dialog-close").on("click",function(a){a.preventDefault(),d.dialog("close")}),a(".js-wpml-ls-dialog-save").on("click",function(a){a.preventDefault();var b=d.find(".js-wpml-ls-subform");D(b)}),a(".js-wpml-ls-open-dialog").on("click",function(b){b.preventDefault();var c,d=a(a(b.target).data("target"));c=d.hasClass("js-wpml-ls-template")?L(d):d.find(".js-wpml-ls-subform"),C(c)})},u=function(){a(".js-wpml-ls-slot-list").on("click",".js-wpml-ls-row-edit",function(b){b.preventDefault();var c=a(a(b.target).parents("tr.js-wpml-ls-row")),d=c.find(".js-wpml-ls-subform");C(d)}).on("click",".js-wpml-ls-row-remove",function(c){if(c.preventDefault(),confirm(b.strings.confirmation_item_remove)){var d=a(this).parents("tr.js-wpml-ls-row"),e=d.data("item-type");d.find(".js-wpml-ls-subform input, .js-wpml-ls-subform select").remove(),U(d,function(){d.fadeOut(800,function(){d.remove(),E(e)})})}})},v=function(){e.on("change",".js-wpml-ls-available-slots",function(){var b=a(this).val(),c=a(this).closest(".js-wpml-ls-subform"),d=c.data("item-type");a(this).removeClass("wpml-ls-required"),N(b,d)&&K(c,b)})},w=function(b){b.find(".js-wpml-ls-colorpicker").each(function(){var b=a(this).clone(),c=a(this).parents(".js-wpml-ls-colorpicker-wrapper");c.empty().html(b)}),s(b)},x=function(){e.on("change",".js-wpml-ls-colorpicker-preset",function(){var c=a(this).val();if(c){var d=a(this).parents(".js-wpml-ls-panel-colors"),e=b.color_schemes[c].values;a.each(e,function(a,b){var c=d.find(".js-wpml-ls-color-"+a);c.attr("value",b),c.parents(".wp-picker-container").find(".wp-color-result").css("background-color",b)}),d.find(".js-wpml-ls-colorpicker").trigger("change")}})},y=function(){e.on("change","select",function(){var b=a(this).val();a("option",this).removeAttr("selected"),a('option[value="'+b+'"]',this).attr("selected","selected")})},z=function(){var b=a("#wpml-ls-refresh-on-browser-back-button");"yes"===b.val()?location.reload(!0):b.val("yes")},A=function(){c.submit(function(a){a.preventDefault(),c.find('input[name="submit_setup_wizard"]').val(1),U(c,function(){location.href=location.href.replace(/#.*/,"")})})},B=function(b){var c=b.data("content");a(".js-wpml-ls-active-tooltip").pointer("close"),b.length&&c&&(b.addClass("js-wpml-ls-active-tooltip"),b.pointer({pointerClass:"js-wpml-ls-tooltip wpml-ls-tooltip",content:c,position:{edge:"bottom",align:"left"},show:function(a,b){b.pointer.css("marginLeft","-54px")},close:function(a,b){b.pointer.css("marginLeft","0")}}).pointer("open"))},C=function(a){var b=a.clone(!0);d.find(".js-wpml-ls-dialog-inner").empty().append(b),""===b.find(".js-wpml-ls-preview").html()&&S(b),O(b),w(b),d.dialog("option","title",b.data("title")).dialog("open")},D=function(b){var c=b.clone(!0),d=b.data("item-type");if(c.find(".js-wpml-ls-preview-wrapper").css("top",0),0<=a.inArray(d,["menus","sidebars"])){var e=b.find(".js-wpml-ls-available-slots").val();N(e,d)?("undefined"==typeof c.data("origin-id")?H(c):G(c),E(d)):I(b)}else"statics"===c.data("item-type")&&F(c)},E=function(c){var d=a("#wpml-language-switcher-"+c),e=d.find(".js-wpml-ls-row").length,f=a.map(b[c],function(a,b){return b}).length;0===e?d.find(".js-wpml-ls-slot-list").fadeOut():d.find(".js-wpml-ls-slot-list").fadeIn(),e===f?d.find("button.js-wpml-ls-open-dialog").attr("disabled","disabled").siblings(".js-wpml-ls-tooltip-wrapper").removeClass("hidden"):d.find("button.js-wpml-ls-open-dialog").removeAttr("disabled").siblings(".js-wpml-ls-tooltip-wrapper").addClass("hidden")},F=function(b){var c=a("#"+b.data("origin-id")),e=b.data("item-slug");c.find(".js-wpml-ls-subform").replaceWith(b),Z("statics",e),U(c,function(){d.find(".js-wpml-ls-dialog-inner").empty(),d.dialog("close")})},G=function(b){var c=a("#"+b.data("origin-id")),e=b.data("item-type"),f=b.find(".js-wpml-ls-available-slots").val();c.find(".js-wpml-ls-subform").replaceWith(b),c.attr("id")!=="wpml-ls-"+e+"-row-"+f&&J(c,e,f),Z(e,f),U(c,function(){d.find(".js-wpml-ls-dialog-inner").empty(),d.dialog("close")})},H=function(b){var e=b.data("item-type"),f=b.find(".js-wpml-ls-available-"+e).val();K(b,f);var g=a.trim(a("#wpml-ls-new-"+e+"-row-template").html()),h=a(a.parseHTML(g));h.find(".js-wpml-ls-subform").replaceWith(b),J(h,e,f),h.hide().appendTo(c.find("#wpml-ls-slot-list-"+e+" > tbody")).show(800),Z(e,f),U(h,function(){d.find(".js-wpml-ls-dialog-inner").empty(),d.dialog("close")})},I=function(a){a.find(".js-wpml-ls-available-slots").addClass("wpml-ls-required"),d.animate({scrollTop:0},300)},J=function(a,c,d){var e="wpml-ls-"+c+"-row-"+d,f=b[c][d].name;a.attr("id",e),a.data("item-type",c),a.find(".js-wpml-ls-subform").addBack().data("item-slug",d),a.find(".js-wpml-ls-subform").data("origin-id",e),a.find(".js-wpml-ls-row-title").html(f)},K=function(b,c){var d="",e=b.data("item-type"),f=b.data("item-slug");b.find("input, select").each(function(b,g){d=a(g).attr("name"),"string"==typeof d&&a(g).attr("name",d.replace(e+"["+f+"]",e+"["+c+"]")),d=a(g).attr("id"),"string"==typeof d&&a(g).attr("id",d.replace(f,c))}),b.find("label").each(function(b,e){d=a(e).attr("for"),"string"==typeof d&&a(e).attr("for",d.replace(f,c))})},L=function(b){var c=a.trim(b.html()),d=a(a.parseHTML(c));return O(d),d},M=function(b){var c=[];return a("#wpml-ls-slot-list-"+b+" .js-wpml-ls-row").each(function(){c.push(a(this).data("item-slug"))}),c},N=function(c,d){var e=a.map(b[d],function(a){return"menus"===d?a.slug:a.id});return 0<=a.inArray(c,e)},O=function(b){var c=b.data("item-type"),d=M(c),e=b.data("item-slug"),f=b.find(".js-wpml-ls-available-slots option");f.each(function(){var b=a(this),c=a.inArray(b.val(),d)>=0,f=b.val();c&&e!==f?b.attr("disabled","disabled"):b.removeAttr("disabled")})},P=function(){e.on("change",'[type!="text"].js-wpml-ls-trigger-update',function(){var b=a(this).parents(".js-wpml-ls-subform");S(b)}).on("keyup",'[type="text"].js-wpml-ls-trigger-update',function(){var b=a(this).parents(".js-wpml-ls-subform");S(b)}).on("keyup",".js-wpml-ls-additional-css",function(){var b="wpml-ls-inline-styles-additional-css",c=a('<style id="'+b+'" type="text/css">'+a(this).val()+"</style>");a("#"+b).replaceWith(c)})},Q=function(){e.on("change",".js-wpml-ls-template-selector",function(){var c=a(this).val(),d=a(this).closest(".js-wpml-ls-subform"),e=b.templates[c].force_settings;d.find(".js-wpml-ls-to-include input").prop("disabled",!1),jQuery.each(e,function(a,b){1===b?d.find(".js-wpml-ls-setting-"+a).attr("checked","checked").prop("disabled",!0):d.find(".js-wpml-ls-setting-"+a).removeAttr("checked").prop("disabled",!0)})})},R=function(){e.on("change",".js-wpml-ls-menu-is-hierarchical",function(){var b=parseInt(a(this).val()),c=a(this).closest(".js-wpml-ls-subform"),d=c.find(".js-wpml-ls-setting-display_link_for_current_lang");d.prop("disabled",!1),1===b&&d.attr("checked","checked").prop("disabled",!0)})},S=_.debounce(function(a){var c=a.find(".js-wpml-ls-preview");if(c.length>0){W(c);var d=V(a);wp.ajax.send({data:{action:"wpml-ls-update-preview",nonce:b.nonce,slot_settings:d},success:function(a){c.empty(),Y(a.styles),$(a.css,c),aa(a.js,c),X(c,a.html)},error:function(a){X(c,a,0,"error")}})}},500),T=function(){c.on("click",".js-wpml-ls-save-settings",function(b){b.preventDefault(),U(a(this))})},U=_.debounce(function(a,d){var e=a.closest(".js-wpml-ls-option").find(".js-wpml-ls-messages"),f=V(c);0===e.length&&(e=a.closest(".js-wpml-ls-section").find(".js-wpml-ls-messages")),e.empty(),W(e),wp.ajax.send({data:{action:"wpml-ls-save-settings",nonce:b.nonce,settings:f},success:function(a){X(e,a,1e3,"updated"),"function"==typeof d&&d()},error:function(a){X(e,a,2e3,"error")}})},500),V=function(a){var b=a.find(":input:disabled").removeAttr("disabled"),c=a.find("input, select, textarea").serialize();return b.attr("disabled","disabled"),c},W=function(b){a(".js-wpml-ls-messages").removeClass("success error").hide().empty(),b.siblings(".spinner").addClass("is-active")},X=function(a,b,c,d){a.siblings(".spinner").removeClass("is-active"),a.removeClass("updated notice error"),d&&a.addClass(d),a.html(b).fadeIn(),c&&a.delay(c).fadeOut()},Y=function(b){if(a("#"+g).remove(),b){var c=a(a.parseHTML(b)).first();c.attr("id",g),a("#"+f).before(c)}},Z=function(b,c){var d=a("#"+g).clone(),e="wpml-ls-inline-styles-"+b+"-"+c,h=a("#"+e);d.attr("id",e),h.length?h.replaceWith(d):a("#"+f).before(d)},$=function(b,c){var d,e,f=c.closest(".js-wpml-ls-preview-wrapper");if(f.find("link").remove(),"undefined"!=typeof b&&null!==b)for(d=0;d<b.length;d++)e=a("<link>"),e.attr("rel","stylesheet"),e.attr("type","text/css"),e.attr("media","all"),e.attr("href",b[d]),e.prependTo(f)},aa=function(b,c){var d,e,f=c.closest(".js-wpml-ls-preview-wrapper");if(f.find("script").remove(),"undefined"!=typeof b&&null!==b)for(d=0;d<b.length;d++)e=a("<script></script>"),e.attr("type","text/javascript"),e.attr("src",b[d]),e.prependTo(f)};return{init:h}}(jQuery,wpml_language_switcher_admin),jQuery(document).ready(function(){"use strict";WPML_core.languageSwitcher.init()});